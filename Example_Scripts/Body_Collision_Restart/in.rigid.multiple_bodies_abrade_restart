# Create multiple abradable bodies, assign them an initial velocity, and output the associated restart files.

###############################################
# Variable Definitions
###############################################


# Variables
variable E equal 4.76*0.1 # Young's modulus [GPa]
variable poisson equal 0.4 # Poisson Ratio [-]
variable G equal ${E}/(2*(1+${poisson})) # Shear modulus [GPa]
variable kn equal (4*${G}/(3*((1-${poisson}))))*(1e+10) # Normal Elastic Constant
variable kt equal (4*${G}/(2-${poisson}))*(1e+10) # Tangential Elastic Constant
variable e equal 0.55 # Coefficient of Restitution [-]
variable xmu equal 0.39 # Friction Coefficient [-]
variable damp_flag equal 1
variable density equal 1.42 # Mass density [g/cm^3]

# Hardnesses have been greatly reduced to unphysical values for demonstration purposes
variable H_input equal 0.1 # Indentation Hardness [GPa]
variable H equal ${H_input}*(1e+10) # [dyne/cm^2]
variable mu equal 0.25 # Scratching/Indentation Hardness Ratio [-]
variable dt equal 5.0e-8 # s

###############################################
# Initialisation
###############################################
units           cgs 
boundary        p p p
atom_style      hybrid molecular sphere
dimension       3
newton          on

###############################################
# Creating the simulation box
###############################################

processors * * *


read_restart example_restart.4999

###############################################
# Particle-related parameters
###############################################
angle_style	zero
angle_style	zero
angle_coeff	* 75.0

# Reading in the torus mol file
molecule torus ./Torus.mol
variable natoms_per_body equal 1729

###############################################
# Pre-fix Settings
###############################################
neighbor 0.2 multi  
comm_modify mode multi vel yes 
â€‹compute t1 all temp/sphere
thermo_modify temp t1

pair_style granular
pair_coeff * * hertz ${kn} ${e} tangential linear_history ${kt} 1.0 ${xmu} damping coeff_restitution limit_damping

timestep ${dt}

###############################################
# Particle Creation
###############################################

# Isolating each body's owning atom (placed at their centres) to specify hybrid neighbor list
group owning id 1:5000:${natoms_per_body} 
group owned subtract all owning 
set group owning type 4 
neigh_modify collection/type 2 *3, 4 
comm_modify cutoff/multi 1 0.0 cutoff/multi 2 5.0 

neigh_modify exclude molecule/intra all
neigh_modify exclude group owning owned
neigh_modify exclude molecule/inter owning

group torus_1 molecule 1
group torus_2 molecule 2

###############################################
# Fix Definitions
###############################################

fix abrade all rigid/abrade ${H} 0.25 ${density} molecule remesh 0.95 equalise normals offset infile example_restart.4999.rigid
compute 3 all rigid/local_abrade abrade id volume surface_area abraded_volume wear_energy

###############################################
# Running Simulation
###############################################


#                                                                   associated_area  cumulative_displacement     normal_x    normal_y     normal_z
dump 1 all custom 500 dump.pos id x y z radius vx vy vz fx fy fz      f_abrade[4]         f_abrade[8]          f_abrade[9] f_abrade[10] f_abrade[11] 
#                                  body_id      volume  surface_area abraded_volume   cumulative_wear_energy
dump 2 all local 500 dump.vol index c_3[1]     c_3[2]       c_3[3]       c_3[4]               c_3[5] 
dump_modify 1 append yes
dump_modify 2 append yes

run 5001





